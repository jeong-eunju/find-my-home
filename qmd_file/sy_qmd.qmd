---
title: "ì´ëŸ° ì§‘ì€ ì‚´ì•„ë‚¨ëŠ”ë‹¤! â€” ì˜ˆì‚° ë‚´ ìµœì ì˜ ì§‘ ì°¾ê¸°"
format:
  dashboard:
    css: custom.css
editor: visual
---

```{python}
import numpy as np
import pandas as pd
pd.set_option('display.max_rows', None)
df = pd.read_excel('../ames_df.xlsx')
df.info()
```

# ğŸšï¸ í”„ë¡œì íŠ¸ ì†Œê°œ

# ğŸ  ë°ì´í„° ì „ì²˜ë¦¬

## 1ï¸âƒ£ í’ˆì§ˆ ë³€ìˆ˜ ìˆ˜ì •í•˜ê¸°

<span style="font-size:20px; font-weight:bold;">1ï¸âƒ£ í’ˆì§ˆ ë³€ìˆ˜ ì „ì²˜ë¦¬</span>
<br>

**â­ ìˆ˜ì¹˜í˜•Â·ë²”ì£¼í˜•, Qual/Condë¡œ ë‚˜ë‰œ í’ˆì§ˆ ë³€ìˆ˜ë¥¼ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ í†µì¼í•´, ê°€ì¤‘í‰ê· ìœ¼ë¡œ ìƒˆë¡œìš´ íŒŒìƒë³€ìˆ˜ ìƒì„±**

<br>

::: {.panel-tabset}

### ğŸ—’ï¸ ë²”ì£¼í˜• ë³€ìˆ˜ â†’ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ

<br>

- **ëŒ€ìƒ ë³€ìˆ˜**
  - ì™¸ë¶€ìì¬: `ExterQual`, `ExterCond`  
  - ì§€í•˜ì‹¤: `BsmtQual`, `BsmtCond`  
  - ë‚œë°©: `HeatingQC`  
  - ì°¨ê³ : `GarageQual`, `GarageCond`

<br>

- **ë³€í™˜ ê¸°ì¤€**
<table style="width:100%; text-align:left; border-collapse:collapse;">
  <thead>
    <tr>
      <th style="padding:12px;">ë“±ê¸‰ ì½”ë“œ</th>
      <th style="padding:12px;">ì˜ë¯¸</th>
      <th style="padding:12px;">ì²˜ë¦¬ ì ìˆ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>Ex</td><td>Excellent (ìµœìƒ)</td><td>5</td></tr>
    <tr><td>Gd</td><td>Good (ìƒ)</td><td>4</td></tr>
    <tr><td>TA</td><td>Typical/Average (ì¤‘)</td><td>3</td></tr>
    <tr><td>Fa</td><td>Fair (í•˜)</td><td>2</td></tr>
    <tr><td>Po</td><td>Poor (ìµœí•˜)</td><td>1</td></tr>
    <tr><td>None, nan, 0</td><td>í•´ë‹¹ ì—†ìŒ</td><td>0</td></tr>
  </tbody>
</table>


```{python}
#| echo: true
qual_map_543210 = {
    'Ex': 5, 'Gd': 4, 'TA': 3, 'Fa': 2, 'Po': 1,
    'None': 0, 'nan': 0, '0': 0
}

qual_vars = [
    "ExterQual", "ExterCond",
    "BsmtQual", "BsmtCond",
    "HeatingQC",
    "GarageQual", "GarageCond"
]

for col in qual_vars:
    df[col] = df[col].astype(str).replace(['nan', 'NaN', '0'], 'None')
    df[col + "_Score"] = df[col].map(qual_map_543210)
```


### ğŸ‘ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •

<br>

**í’ˆì§ˆ ë³€ìˆ˜ê°€ Qual, Condë¡œ ë‚˜ëˆ„ì–´ì ¸ìˆëŠ” ê²½ìš° ê°€ì¤‘í‰ê· ìœ¼ë¡œ í•˜ë‚˜ì˜ í’ˆì§ˆë³€ìˆ˜ë¡œ í†µí•©**

<br>

- `Qual`, `Cond` ë³€ìˆ˜ì™€ `SalePrice` ìƒê´€ê´€ê³„ í™•ì¸

```{python}
#| echo: True
#| eval: false
df[["SalePrice", "OverallQual", "OverallCond"]].corr()
df[["SalePrice", "ExterQual_Score", "ExterCond_Score"]].corr()
df[["SalePrice", "GarageQual_Score", "GarageCond_Score"]].corr()
df[["SalePrice", "BsmtQual_Score", "BsmtCond_Score"]].corr()
```

```{python}

#| echo: false
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# í•œê¸€ í°íŠ¸ ì„¤ì • (Windows ê¸°ì¤€)
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 2x2 íˆíŠ¸ë§µì„ ìœ„í•œ ë³€ìˆ˜ ìŒ
heatmap_info = [
    (['SalePrice', 'OverallQual', 'OverallCond'], "Overall í’ˆì§ˆ"),
    (['SalePrice', 'ExterQual_Score', 'ExterCond_Score'], "ì™¸ë¶€ìì¬ í’ˆì§ˆ"),
    (['SalePrice', 'GarageQual_Score', 'GarageCond_Score'], "ì°¨ê³  í’ˆì§ˆ"),
    (['SalePrice', 'BsmtQual_Score', 'BsmtCond_Score'], "ì§€í•˜ì‹¤ í’ˆì§ˆ"),
]

# ì‹œê°í™”
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

for i, (cols, title) in enumerate(heatmap_info):
    row, col = divmod(i, 2)
    ax = axes[row, col]
    corr = df[cols].corr()
    sns.heatmap(corr, annot=True, cmap='coolwarm', fmt=".2f", ax=ax, cbar=False)
    _ = ax.set_title(f"{title} vs ì§‘ê°’")  # Text ì¶œë ¥ ë°©ì§€


plt.tight_layout()
plt.show()
```

<br>

- *âœ”ï¸ ìƒê´€ê´€ê³„ ê²°ê³¼ í™•ì¸ ë° ê°€ì¤‘ì¹˜ ì„¤ì •**

| ìƒˆë¡œìš´ íŒŒìƒë³€ìˆ˜ | ê¸°ì¡´ ë³€ìˆ˜                   | ì§‘ê°’ê³¼ì˜ ìƒê´€ê³„ìˆ˜ | ê°€ì¤‘ì¹˜ |
|----------------|-----------------------------|--------------------|------------------|
| Overall        | OverallQual / OverallCond   | 0.79 / -0.11       | 7 : 3            |
| Exter          | ExterQual / ExterCond       | 0.68 / 0.01        | 9 : 1            |
| Garage         | GarageQual / GarageCond     | 0.26 / 0.24        | 7 : 3            |
| Bsmt           | BsmtQual / BsmtCond         | 0.58 / 0.20        | 7 : 3            |


### ğŸ˜® íŒŒìƒë³€ìˆ˜ ìƒì„± (ê°€ì¤‘í‰ê· )

<br>

**ê°€ì¤‘ì¹˜ ë°˜ì˜í•œ íŒŒìƒë³€ìˆ˜ ìƒì„± í›„ ê¸°ì¡´ì˜ `Qual`, `Cond` ë³€ìˆ˜ ì‚­ì œ**

<br>

```{python}
#| echo: True
df['Overall'] = df['OverallQual'] * 0.7 + df['OverallCond'] * 0.3
df['Exter'] = df['ExterQual_Score'] * 0.9 + df['ExterCond_Score'] * 0.1
df['Garage'] = df['GarageQual_Score'] * 0.7 + df['GarageCond_Score'] * 0.3
df["Bsmt"] = df["BsmtQual_Score"] * 0.7 + df["BsmtCond_Score"] * 0.3

cols_to_drop = [
    'OverallQual', 'OverallCond',
    'ExterQual', 'ExterCond',
    'BsmtQual', 'BsmtCond',
    'GarageQual', 'GarageCond',
    'ExterQual_Score', 'ExterCond_Score',
    'BsmtQual_Score', 'BsmtCond_Score',
    'GarageQual_Score', 'GarageCond_Score', 
    'Latitude', 'Longitude','HeatingQC'
]

df = df.drop(columns=cols_to_drop)

```

<br>

- í’ˆì§ˆ ê´€ë ¨ íŒŒìƒë³€ìˆ˜ í™•ì¸ `.head(5)`
```{python}
#| echo: False
df[['Overall', 'Exter', 'Garage', 'Bsmt', 'HeatingQC_Score']].head(5)
```

::::

##2ï¸âƒ£ ì˜ˆì‚° í•„í„°ë§
<span style="font-size:20px; font-weight:bold;">2ï¸âƒ£ ì˜ˆì‚° í•„í„°ë§</span>
- ì˜ˆì‚° í•„í„°ë§: 13ë§Œ ë‹¬ëŸ¬ ì´ìƒ, 20ë§Œ ë‹¬ëŸ¬ ì´í•˜

```{python}

filtered = df[(df['SalePrice'] >= 130000) & (df['SalePrice'] <= 200000)]

import numpy as np

# ì „ì²´ êµ¬ê°„ ê¸°ì¤€ìœ¼ë¡œ bin ê²½ê³„ ìˆ˜ë™ ì„¤ì •
bins = np.histogram_bin_edges(df['SalePrice'], bins=30)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.hist(df['SalePrice'], bins=bins, color='lightgray', edgecolor='black', label='ì „ì²´ ë¶„í¬')
plt.hist(filtered['SalePrice'], bins=bins, color='skyblue', edgecolor='black', label='ì˜ˆì‚° ë‚´ ë¶„í¬')

plt.title('ì§‘ê°’ ë¶„í¬ (ì˜ˆì‚° í•„í„°ë§)')
plt.xlabel('SalePrice')
plt.ylabel('ê±´ìˆ˜')
plt.legend()
plt.tight_layout()
plt.show()

# # ì‹œê°í™”
# import matplotlib.pyplot as plt
# plt.figure(figsize=(10, 6))
# plt.hist(df['SalePrice'], bins=30, color='skyblue', edgecolor='black')
# plt.title('ì§‘ê°’ ë¶„í¬')
# plt.show()

# ì˜ˆì‚° í•„í„°ë§
df = df[df['SalePrice'] >= 130000]
df = df[df['SalePrice'] <= 200000]
```

##3ï¸âƒ£ íšŒê·€ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° ì „ì²˜ë¦¬
<span style="font-size:20px; font-weight:bold;">3ï¸âƒ£ íšŒê·€ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° ì „ì²˜ë¦¬</span>
<br>

- ì¢…ì† ë³€ìˆ˜ y ë¶„ë¦¬: `SalePrice`
- ë…ë¦½ë³€ìˆ˜ X: ìˆ˜ì¹˜í˜• + ë²”ì£¼í˜• ë¶„ë¦¬
    - ìˆ˜ì¹˜í˜•: StandardScaler() ì ìš©
    - ë²”ì£¼í˜•: OneHotEncoder() ì ìš©
- ìˆ˜ì¹˜í˜•+ë²”ì£¼í˜• ë°ì´í„° í•©ì¹˜ê¸°
```{python}
#| echo: True
# x, y ë¶„ë¦¬! 
X = df.drop(columns='SalePrice')
y = (df['SalePrice'])

# X -> ìˆ˜ì¹˜í˜•, ë²”ì£¼í˜• ë¶„ë¦¬
num_columns = X.select_dtypes(include=['number']).columns
cat_columns = X.select_dtypes(include=['object']).columns

# ë²”ì£¼í˜•ì€ ì›í•«, ìˆ˜ì¹˜í˜•ì€ ìŠ¤ì¼€ì¼ë§ 
from sklearn.preprocessing import OneHotEncoder
from sklearn.preprocessing import StandardScaler
onehot = OneHotEncoder(handle_unknown='ignore', 
                       sparse_output=False)
X_train_cat = onehot.fit_transform(X[cat_columns])

std_scaler = StandardScaler()
X_train_num = std_scaler.fit_transform(X[num_columns])

X_train_all = np.concatenate([X_train_num, X_train_cat], axis = 1)

```