---
<<<<<<< HEAD
title: "Ames Housing Dashboard"
format: dashboard
page-navigation: true
---

::: {.column-page}

## Lasso ë¶„ì„

```{python}
import numpy as np
import pandas as pd
pd.set_option('display.max_rows', None)
df = pd.read_excel('../find-my-home/ames_df.xlsx')

# ì „ì²˜ë¦¬###############################################################
# ìˆ˜ì¹˜í˜• ë³€ìˆ˜ qual, cond ê°€ì¤‘ì¹˜ì¤˜ì„œ ìƒˆë¡œìš´ ì—´ ì¶”ê°€
# ê°€ì¤‘ì¹˜ ì£¼ê¸° ìœ„í•´ ìƒê´€ê³„ìˆ˜ ë¶„ì„
df[['SalePrice', 'OverallQual', 'OverallCond']].corr()  ## Qualì´ ìƒê´€ê³„ìˆ˜ ë†’ê²Œ ë‚˜ì™€ Qualê°€ì¤‘ì¹˜ë¥¼ 7ë¡œ ì¤Œ

# Overall ì ìˆ˜ ê³„ì‚° (OverallQual 70%, OverallCond 30%)
df['Overall'] = df['OverallQual'] * 0.7 + df['OverallCond'] * 0.3
df


# ë²”ì£¼í˜• ë³€ìˆ˜ qual, cond ê°€ì¤‘ì¹˜ì¤˜ì„œ ìƒˆë¡œìš´ ì—´ ì¶”ê°€
# ì ìˆ˜í™” ê¸°ì¤€ (543210 ìŠ¤ì¼€ì¼)
qual_map_543210 = {
    'Ex': 5,
    'Gd': 4,
    'TA': 3,
    'Fa': 2,
    'Po': 1,
    'None': 0,
    'nan': 0,
    '0': 0
}

# ëŒ€ìƒ ë³€ìˆ˜
qual_vars = [
    "ExterQual", "ExterCond",
    "BsmtQual", "BsmtCond",
    "HeatingQC",
    "GarageQual", "GarageCond"
]



for col in qual_vars:
    df[col] = df[col].astype(str).replace(['nan', 'NaN', '0'], 'None')  # ì˜ˆì™¸ì²˜ë¦¬ ê°•í™”
    df[col + "_Score"] = df[col].map(qual_map_543210)

# ê²°ê³¼ ì¼ë¶€ í™•ì¸
df[[col + "_Score" for col in qual_vars]]

# í€„ë¦¬í‹° ìƒê´€ê´€ê³„ í™•ì¸
df[["SalePrice", "OverallQual", "OverallCond"]].corr()
df[["SalePrice", "ExterQual_Score", "ExterCond_Score"]].corr()
df[["SalePrice", "GarageQual_Score", "GarageCond_Score"]].corr()
df[["SalePrice", "BsmtQual_Score", "BsmtCond_Score"]].corr()

# ë²”ì£¼í˜• ë°ì´í„° ê°€ì¤‘ì¹˜ ì—´ ì¶”ê°€
df['Exter'] = df['ExterQual_Score'] * 0.9 + df['ExterCond_Score'] * 0.1
df['Garage'] = df['GarageQual_Score'] * 0.7 + df['GarageCond_Score'] * 0.3
df["Bsmt"] = df["BsmtQual_Score"] * 0.7 + df["BsmtCond_Score"] * 0.3
df.info()

cols_to_drop = [
    'OverallQual', 'OverallCond',
    'ExterQual', 'ExterCond',
    'BsmtQual', 'BsmtCond',
    'GarageQual', 'GarageCond',
    'ExterQual_Score', 'ExterCond_Score',
    'BsmtQual_Score', 'BsmtCond_Score',
    'GarageQual_Score', 'GarageCond_Score'
]

df = df.drop(columns=cols_to_drop)


# ì˜ˆì‚° í•„í„°ë§
df = df[df['SalePrice'] >= 130000]
df = df[df['SalePrice'] <= 200000]

# x, y ë¶„ë¦¬! 
X = df.drop(columns='SalePrice')
y = (df['SalePrice'])

# X -> ìˆ˜ì¹˜í˜•, ë²”ì£¼í˜• ë¶„ë¦¬
num_columns = X.select_dtypes(include=['number']).columns
cat_columns = X.select_dtypes(include=['object']).columns

# ë²”ì£¼í˜•ì€ ì›í•«, ìˆ˜ì¹˜í˜•ì€ ìŠ¤ì¼€ì¼ë§ 
from sklearn.preprocessing import OneHotEncoder
from sklearn.preprocessing import StandardScaler
onehot = OneHotEncoder(handle_unknown='ignore', 
                       sparse_output=False)
X_train_cat = onehot.fit_transform(X[cat_columns])

std_scaler = StandardScaler()
X_train_num = std_scaler.fit_transform(X[num_columns])

X_train_all = np.concatenate([X_train_num, X_train_cat], axis = 1)


# LassoCV -> ê°€ê²©ì— ë§ì€ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë³€ìˆ˜ ì°¾ê¸°
from sklearn.linear_model import LassoCV
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import make_pipeline
from sklearn.model_selection import train_test_split

alpha = np.linspace(0, 0.5, 1000)
lasso_cv = LassoCV(alphas=alpha,
                   cv=5,
                   max_iter=1000)
lasso_cv.fit(X_train_all, y)
lasso_cv.alpha_     # ì•„ë˜ ê³„ì‚°í•œ ê²ƒë“¤ í‰ê· ë‚´ì„œ ìµœì ì˜ ëŒë‹¤ê°’ ì°¾ì€ ê²ƒ
lasso_cv.mse_path_
lasso_cv_coef = lasso_cv.coef_

# 1. ì›í•« ë²”ì£¼í˜• ë³€ìˆ˜ ì´ë¦„ ë½‘ê¸°
cat_feature_names = onehot.get_feature_names_out(cat_columns)

# 2. ì „ì²´ ë³€ìˆ˜ ì´ë¦„ (ìˆ˜ì¹˜í˜• + ë²”ì£¼í˜•)
feature_names = np.concatenate([num_columns, cat_feature_names])

# 3. LassoCVì—ì„œ ë‚˜ì˜¨ ê³„ìˆ˜ì™€ ë³€ìˆ˜ì´ë¦„ ë§¤ì¹­
lasso_coef = lasso_cv.coef_

# 4. DataFrameìœ¼ë¡œ ì •ë¦¬ + ì ˆëŒ€ê°’ ê¸°ì¤€ ì •ë ¬
coef_df = pd.DataFrame({
    'Feature': feature_names,
    'Coefficient': lasso_coef
})
coef_df['AbsCoefficient'] = coef_df['Coefficient'].abs()
coef_df = coef_df.sort_values('AbsCoefficient', ascending=False)

print(coef_df)

# 0ì¸ ê°’ ì œê±°
coef_df = coef_df[coef_df['Coefficient'] != 0]
coef_df = coef_df.sort_values('Coefficient', ascending=False)
coef_df.shape


# ì˜ˆì‹œ: df_sortedëŠ” Feature, Coefficient ë“±ì´ í¬í•¨ëœ ì •ë¦¬ëœ ê²°ê³¼ ë°ì´í„°í”„ë ˆì„
coef_df['Prefix'] = coef_df['Feature'].apply(lambda x: x.split('_')[0] if '_' in x else x)

# ê·¸ë£¹ë³„ë¡œ ë¬¶ê¸° (ì˜ˆ: í‰ê· /í•©ê³„/ê°¯ìˆ˜ ë“± ì§‘ê³„ë„ ê°€ëŠ¥)
grouped = coef_df.groupby('Prefix')

# ì˜ˆì‹œ: ê·¸ë£¹ë³„ Feature ê°œìˆ˜ í™•ì¸
print(grouped.size())

# ì˜ˆì‹œ: ê·¸ë£¹ë³„ Coefficient ì´í•© ë³´ê¸°   
print(grouped['AbsCoefficient'].mean().sort_values(ascending=False))
```
```{python}
#| echo: false
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.linear_model import LassoCV
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, OneHotEncoder
import numpy as np

# ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
# (ì´ì „ì˜ ì „ì²´ ì½”ë“œê°€ ì—¬ê¸°ì— ì‚½ì…ë  ìˆ˜ ìˆìŒ)

# ì¤‘ìš”ë„ ì‹œê°í™”
top_n = 20
coef_df = coef_df.sort_values('Coefficient', ascending=False).head(top_n)
plt.figure(figsize=(10, 6))
plt.barh(coef_df['Feature'], coef_df['Coefficient'])
plt.xlabel('Coefficient')
plt.title('Top 20 Important Features by Lasso Regression')
plt.gca().invert_yaxis()
plt.tight_layout()
plt.show()
```

## í’ˆì§ˆ ì ìˆ˜ ì‚°ì ë„

```{python}
#| echo: false
import seaborn as sns
score_vars = ['Overall', 'Exter', 'Garage', 'Bsmt']
for var in score_vars:
    plt.figure(figsize=(6, 4))
    sns.scatterplot(data=df, x=var, y='SalePrice')
    plt.title(f'{var} vs SalePrice')
    plt.tight_layout()
    plt.show()
```

## ìƒê´€ê³„ìˆ˜ Heatmap

```{python}
#| echo: false
num_columns = df.select_dtypes(include=['number']).columns.drop('SalePrice')
top_corr_features = df[num_columns].corrwith(df['SalePrice']).abs().sort_values(ascending=False).head(10).index
plt.figure(figsize=(10, 8))
sns.heatmap(df[top_corr_features.to_list() + ['SalePrice']].corr(), annot=True, cmap='coolwarm')
plt.title("Top Correlated Numeric Features")
plt.tight_layout()
plt.show()
```

## ì§€ë„ ì‹œê°í™”

```{python}
#| echo: false
import plotly.express as px
fig = px.scatter_mapbox(
    df,
    lat="Latitude",
    lon="Longitude",
    size="PriceNorm",
    color="SalePrice",
    color_continuous_scale="Viridis",
    size_max=50,
    zoom=11,
    hover_name="Neighborhood",
    hover_data={"SalePrice": True, "Exter": True, "Garage": True, "Bsmt": True, "Overall": True},
    title="ğŸ  Ames ì£¼íƒ ê°€ê²© ì§€ë„ (ì •ê·œí™”ëœ ê°€ê²© ê¸°ë°˜)",
    mapbox_style="open-street-map"
)
fig.update_layout(mapbox_center={"lat": 42.03, "lon": -93.62}, mapbox_zoom=12, margin={"r":0,"t":40,"l":0,"b":0})
fig.show()
```

:::
=======
title: "ì´ëŸ° ì§‘ì€ ì‚´ì•„ë‚¨ëŠ”ë‹¤! â€” ì˜ˆì‚° ë‚´ ìµœì ì˜ ì§‘ ì°¾ê¸°"
format:
  dashboard:
    css: custom.css
editor: visual
---

# ğŸšï¸ í”„ë¡œì íŠ¸ ì†Œê°œ

## ì£¼ì œ

::: callout-tip
ğŸ’¡ ì´ í”„ë¡œì íŠ¸ëŠ” **"ë‚´ê°€ ì–‘ë³´í•´ì•¼ í•˜ëŠ” ì˜µì…˜ vs ê¼­ ì±™ê²¨ì•¼ í•˜ëŠ” ì˜µì…˜"**ì„\
**ë°ì´í„°ë¡œ ì„¤ë“ë ¥ ìˆê²Œ ì„¤ëª…í•˜ê¸° ìœ„í•œ ë¶„ì„ì…ë‹ˆë‹¤.**
:::

### ğŸ¡ ì‹œë‚˜ë¦¬ì˜¤

> **â€œì €ëŠ” 13ë§Œ ë‹¬ëŸ¬ì— ëŒ€ì¶œê¹Œì§€ ë•¡ê²¨ì„œ ìµœëŒ€ 20ë§Œ ë‹¬ëŸ¬ê¹Œì§€ì˜ ì˜ˆì‚°ì„ ê°€ì§€ê³  ì§‘ì„ êµ¬í•˜ë ¤ê³  í•©ë‹ˆë‹¤.â€**\
> í•˜ì§€ë§Œ!\
> **ì˜ˆì‚° ì•ˆì—ì„œ ëª¨ë“  ì˜µì…˜ì„ ì±™ê¸¸ ìˆœ ì—†ê² ì£ ?**\
> ê·¸ë ‡ë‹¤ë©´ ì–´ë–¤ ì˜µì…˜ì„ í¬ê¸°í•˜ê³ , ì–´ë–¤ ì˜µì…˜ì€ ê¼­ ì§€ì¼œì•¼ í• ê¹Œìš”?

## ğŸ” ìš°ë¦¬ì˜ ë¶„ì„ ì•„ì´ë””ì–´

-   **ì˜ˆì‚° ë‚´ì—ì„œ ê°€ì¥ ì¢‹ì€ ì§‘ì€ ì–´ë–¤ ì§‘ì¼ê¹Œ?**\
-   **ë‚´ê°€ ì›í•˜ëŠ” ì˜µì…˜ì´ ê°€ê²©ì„ ë§ì´ í”ë“œëŠ” ì˜µì…˜ì´ë¼ë©´ í¬ê¸°í•´ì•¼ í• ê¹Œ?**\
-   **ê°€ê²©ì— ì˜í–¥ì„ ë§ì´ ì£¼ëŠ” ì˜µì…˜ vs ì ê²Œ ì£¼ëŠ” ì˜µì…˜ â†’ ë°ì´í„°ë¡œ í™•ì¸!**

ğŸ¯ *â€œê°ìœ¼ë¡œ ì„ íƒí•˜ì§€ ë§ê³ , ë°ì´í„°ë¡œ í•©ë¦¬ì ìœ¼ë¡œ ì„ íƒí•˜ìâ€*

## ğŸ—ºï¸ ë¶„ì„ íë¦„

â‘  ì˜ˆì‚° ê¸°ì¤€ìœ¼ë¡œ ì§‘ í•„í„°ë§\
â‘¡ **Lasso (ElasticNet)** íšŒê·€ë¡œ ë³€ìˆ˜ ì¤‘ìš”ë„ ë¶„ì„\
â‘¢ **ì¤‘ìš”ë„ê°€ ë†’ì€ ì˜µì…˜ â†’ í¬ê¸°í• ì§€ ê³ ë¯¼**\
â‘£ ì§€ë„ ì‹œê°í™” â†’ ì˜µì…˜ ì„ íƒì— ë”°ë¥¸ ì§‘ ë¶„í¬ í™•ì¸

## ğŸ—‚ï¸ ë°ì´í„°ì…‹ ì„¤ëª…

-   **Ames Housing Dataset**\
-   ë¯¸êµ­ Iowaì£¼ Amesì‹œì˜ ì£¼íƒ ê±°ë˜ ë°ì´í„° (2930ê±´, 80ê°œ ì´ìƒ ë³€ìˆ˜)\
-   ì‹¤ê±°ë˜ ê¸°ë°˜ìœ¼ë¡œ ì§‘ê°’ê³¼ ì˜µì…˜ì˜ ê´€ê³„ë¥¼ ë¶„ì„í•˜ê¸°ì— ì í•©

## ğŸ·ï¸ ì£¼ìš” ë³€ìˆ˜ ì„¤ëª…

| ë³€ìˆ˜ëª…       | ì„¤ëª…                           | íƒ€ì…          |
|--------------|--------------------------------|---------------|
| SalePrice    | íŒë§¤ ê°€ê²©                      | ìˆ˜ì¹˜í˜•        |
| GrLivArea    | ì§€ìƒ ê±°ì£¼ ë©´ì  (sqft)          | ìˆ˜ì¹˜í˜•        |
| OverallQual  | ì „ë°˜ì ì¸ ê±´ì¶• í’ˆì§ˆ (1\~10)     | ë²”ì£¼í˜•/ìˆ˜ì¹˜í˜• |
| BedroomAbvGr | ì§€ìƒì¸µ ë°© ê°œìˆ˜                 | ìˆ˜ì¹˜í˜•        |
| FullBath     | ì „ìš© ìš•ì‹¤ ìˆ˜                   | ìˆ˜ì¹˜í˜•        |
| GarageCars   | ì°¨ê³  ì°¨ëŸ‰ ìˆ˜                   | ìˆ˜ì¹˜í˜•        |
| KitchenQual  | ì£¼ë°© í’ˆì§ˆ (Ex, Gd, TA, Fa, Po) | ë²”ì£¼í˜•        |
| Fence        | ìš¸íƒ€ë¦¬ í’ˆì§ˆ                    | ë²”ì£¼í˜•        |
| Neighborhood | ìœ„ì¹˜ (ë™ë„¤)                    | ë²”ì£¼í˜•        |

## ğŸ–¼ï¸ ë³€ìˆ˜ì™€ ì§‘ê°’ì˜ ê´€ê³„ (ì‚¬ì „ íƒìƒ‰)

> **â€œì´ ë³€ìˆ˜ë“¤ì´ ê³¼ì—° ì§‘ê°’ì— ì–¼ë§ˆë‚˜ ì˜í–¥ì„ ì¤„ê¹Œ?â€**

{python} import pandas as pd import seaborn as sns import matplotlib.pyplot as plt

df = pd.read_excel('ames_df.xlsx')

# ì£¼ìš” ë³€ìˆ˜ë“¤ ê°„ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ (ì˜ˆì‹œ ì½”ë“œ)

plt.figure(figsize=(8,6)) sns.heatmap(df\[\['SalePrice', 'OverallQual', 'FullBath', 'GarageCars'\]\].corr(), annot=True, cmap='coolwarm') plt.title('ğŸ˜ï¸ ì£¼ìš” ë³€ìˆ˜ì™€ ì§‘ê°’ì˜ ìƒê´€ê´€ê³„') plt.show()

# ğŸ  ë°ì´í„° ì „ì²˜ë¦¬

-   Ames Housing Dataset\
-   ì£¼ìš” ë³€ìˆ˜:
    -   SalePrice, FullBath, BedroomAbvGr, KitchenQual, Fence, FireplaceQu, GarageCars, Neighborhood

# ğŸ¡ ë¶„ì„ê³¼ì •

## ğŸ“Œ ì „ì²˜ë¦¬ ë‚´ìš©

-   Fence, FireplaceQu: ê²°ì¸¡ â†’ 'ì—†ìŒ'ìœ¼ë¡œ ì²˜ë¦¬
-   LotFrontage: í‰ê· ê°’ ëŒ€ì²´
-   Basement, Garage: ì—†ëŠ” ê²½ìš° 0ìœ¼ë¡œ ì±„ì›€

## ğŸ“Œ ë³€ìˆ˜ ì¤‘ìš”ë„

-   ê°€ê²©ì— ì˜í–¥ì„ ì£¼ëŠ” ë³€ìˆ˜:\
    LassoCV ëª¨ë¸ì„ í†µí•´ ë³€ìˆ˜ ì¤‘ìš”ë„ ë„ì¶œ\
    ì˜ˆì‹œ â†’ OverallQual, KitchenQual, GarageCars, GrLivArea, Neighborhood

# ğŸ˜ï¸ ê²°ê³¼

## ğŸ“ Ames Housing Map

<iframe src="map.html" width="100%" height="600px" style="border:none;">

</iframe>

------------------------------------------------------------------------

<iframe src="map_filtered.html" width="100%" height="600px" style="border:none;">

</iframe>

------------------------------------------------------------------------

<<<<<<< HEAD
<iframe src="map_filtered_with_special.html" width="100%" height="600px" style="border:none;">

</iframe>
=======
<iframe src="map_filtered_with_special.html" width="100%" height="600px" style="border:none;"></iframe>
>>>>>>> f90a4b3fc4990cef2aecc274f42fc19480edc538
>>>>>>> 1ca323ebebfb19ec2494ae18666c5a3c18c7dfdf
